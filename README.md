# Hisense-to-MQTT
MQTT adapter for Hisense AC

Адаптер для упарвления кондиционерами Hisense Smart DC Inverter.

Код написан в среде Arduino с использованием ESP8266. Используется чип ESP-12F. Предполагается, что IDE уже настроена для работы с ESP8266. Для компиляции прошивки необходимо через менеджер библиотек установить следующие библиотеки:
- [arduinojson](https://arduinojson.org/)
- [arduino-mqtt](https://github.com/256dpi/arduino-mqtt)
- [IotWebConf](https://github.com/prampec/IotWebConf)
- [GParser](https://github.com/GyverLibs/GParser)
- [TimerMs](https://github.com/GyverLibs/TimerMs)

**Важно:**
Библиотека IotWebConf по умолчанию находится в Debag-mode, и поэтому сыпет логами в Serial, что неприемлемо, так как Serial используется для взаимодействия с кондиционером. Возможность отключения Debug предусмотрена только при работе с VSCode. Если же используется IDE Arduino, то Debag можно отключить, добавив в файл Ваше_расположение\Arduino\libraries\IotWebConf\src\IotWebConfSettings.h в самом начале строчку:

`#define IOTWEBCONF_DEBUG_DISABLED`

**Использование**
После загрузки в чип и запуска инициируется точка доступа "HisenseTest". Подключившись к ней, нужно зайти браузером по адресу 192.168.4.1. Логин/пароль по умолчанию Admin/Admin. В открывшейся странице задаются:
- Имя модуля
- Пароль администратора для будущего входа на данную страницу
- SSID и пароль домашней сети
- Параметры MQTT-брокера (адрес, логин, пароль)

После ввода и сохранения всех параметров произойдёт перезагрузка, и введённые параметры вступят в силу.
На плате предусмотрен светодиод, который индицирует режим работы (есть/нет подключение к серверу) и в штатном режиме он изредка мигает.

При подключении к MQTT-брокеру модуль публикует 2 топика:
1. devices/{Имя_модуля}/status. Здесь раз в 5 сек. в формате выводятся данные о состоянии кондиционера:
   


